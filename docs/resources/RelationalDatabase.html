<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Relational Database · Nimbus</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;A traditional relational database deployment.&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Relational Database · Nimbus"/><meta property="og:type" content="website"/><meta property="og:url" content="https://nimbusframework.com/"/><meta property="og:description" content="&lt;p&gt;A traditional relational database deployment.&lt;/p&gt;
"/><meta property="og:image" content="https://nimbusframework.com/img/nimbus.png"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-138229567-1', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/nimbus.svg" alt="Nimbus"/><h2 class="headerTitleWithLogo">Nimbus</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/Introduction" target="_self">Docs</a></li><li class=""><a href="/docs/gettingstarted" target="_self">Getting Started</a></li><li class=""><a href="/help" target="_self">Help</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Deploying Resources</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Documentation</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/Introduction">Introduction</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Deploying Resources</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/resources/FileStorageBucket">File Storage Bucket</a></li><li class="navListItem"><a class="navItem" href="/docs/resources/DocumentStore">Document Store</a></li><li class="navListItem"><a class="navItem" href="/docs/resources/KeyValueStore">Key-Value Store</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/resources/RelationalDatabase">Relational Database</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Functions</h4><ul><li class="navListItem"><a class="navItem" href="/docs/resources/functions/HttpFunction">HTTP Function</a></li><li class="navListItem"><a class="navItem" href="/docs/resources/functions/WebSocketFunction">WebSocket Function</a></li><li class="navListItem"><a class="navItem" href="/docs/resources/functions/DocumentStoreFunction">Document Store Function</a></li><li class="navListItem"><a class="navItem" href="/docs/resources/functions/KeyValueStoreFunction">Key-Value Store Function</a></li><li class="navListItem"><a class="navItem" href="/docs/resources/functions/NotificationFunction">Notification Function</a></li><li class="navListItem"><a class="navItem" href="/docs/resources/functions/QueueFunction">Queue Function</a></li><li class="navListItem"><a class="navItem" href="/docs/resources/functions/BasicFunction">Basic Function</a></li><li class="navListItem"><a class="navItem" href="/docs/resources/functions/FileStorageBucketFunction">File Storage Function</a></li><li class="navListItem"><a class="navItem" href="/docs/resources/functions/AfterDeployment">After Deployment Function</a></li><li class="navListItem"><a class="navItem" href="/docs/resources/functions/EnvironmentVariables">Environment Variables</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Clients</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/clients/DocumentStoreClient">Document Store Client</a></li><li class="navListItem"><a class="navItem" href="/docs/clients/KeyValueStoreClient">Key-Value Store Client</a></li><li class="navListItem"><a class="navItem" href="/docs/clients/FileStorageClient">File Storage Client</a></li><li class="navListItem"><a class="navItem" href="/docs/clients/WebSocketServerlessFunctionClient">WebSocket Management Client</a></li><li class="navListItem"><a class="navItem" href="/docs/clients/BasicServerlessFunctionClient">Basic Serverless Function Client</a></li><li class="navListItem"><a class="navItem" href="/docs/clients/NotificationClient">Notification Topic Client</a></li><li class="navListItem"><a class="navItem" href="/docs/clients/QueueClient">Queue Client</a></li><li class="navListItem"><a class="navItem" href="/docs/clients/DatabaseClient">Relational Database Client</a></li><li class="navListItem"><a class="navItem" href="/docs/clients/EnvironmentVariableClient">Environment Variable Client</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Local Deployment</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/localdeployment/UnitTests">Unit Testing</a></li><li class="navListItem"><a class="navItem" href="/docs/localdeployment/LocalServer">Local Server</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Relational Database</h1></header><article><div><span><p>A traditional relational database deployment.</p>
<h2><a class="anchor" aria-hidden="true" id="basic-usage"></a><a href="#basic-usage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Basic Usage</h2>
<p>To declare a relational database a class is annotated with @RelationalDatabase. A database name needs to be provided, along with master login credentials. Finally the database language needs to be provided.</p>
<p>A basic example is shown below:</p>
<pre><code class="hljs css language-java"><span class="hljs-meta">@RelationalDatabase</span>(
        name = <span class="hljs-string">"NimbusExampleDatabase"</span>,
        username = <span class="hljs-string">"master"</span>,
        password = <span class="hljs-string">"387tyiehfjkd7f6s8"</span>,
        databaseLanguage = DatabaseLanguage.MYSQL
)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProjectDatabase</span> </span>{}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="database-configuration"></a><a href="#database-configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Database Configuration</h2>
<p>The database languages supported are:</p>
<ul>
<li>MySQL</li>
<li>PostgreSQL,</li>
<li>Oracle database,</li>
<li>MariaDB,</li>
<li>Microsoft SQL Server</li>
</ul>
<p>Additionally, the database performance can be configured with the <code>databaseSize</code> parameter. The specifics will vary provider to provider, but the FREE option will always give you the free tier offering. To customise the allocated storage space the <code>allocatedSizeGB</code> parameter can be set. The minimum is 20GB.</p>
<h2><a class="anchor" aria-hidden="true" id="secure-credentials"></a><a href="#secure-credentials" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Secure Credentials</h2>
<p>As it is likely you do not want the master credentials exposed in the project you can use environment variables to set the username and password. To do this you replace the username and/or password values with <code>${ENVIRONMENT_VARIABLE}</code> where ENVIRONMENT_VARIABLE is the key name of an environment variable. This environment variable needs to be available during the compile time of your code.</p>
<p>An example of this is:</p>
<pre><code class="hljs css language-java"><span class="hljs-meta">@RelationalDatabase</span>(
        name = <span class="hljs-string">"NimbusExampleDatabase"</span>,
        username = <span class="hljs-string">"master"</span>,
        password = <span class="hljs-string">"${DATABASE_PASSWORD}"</span>,
        databaseLanguage = DatabaseLanguage.MYSQL
)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProjectDatabase</span> </span>{}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="migrating-schema"></a><a href="#migrating-schema" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Migrating Schema</h2>
<p>The database will initially not contain any schema, so this will need to be created. To do this it is recommended that you use the <code>@AfterDeployment</code> annotation on a function to perform the creation. You can use a <code>RelationalDatabaseClient</code> to get the connection to the database and then plug that into a framework of your choice. Any deployment scripts/files must be included in the resources of your project as the <code>@AfterDeployment</code> function is deployed as a serverless function.</p>
<p>An example of a complete database with a liquibase migration is:</p>
<pre><code class="hljs css language-java"><span class="hljs-meta">@RelationalDatabase</span>(
        name = <span class="hljs-string">"NimbusExampleDatabase"</span>,
        username = <span class="hljs-string">"master"</span>,
        password = <span class="hljs-string">"387tyiehfjkd7f6s8"</span>,
        databaseLanguage = DatabaseLanguage.MYSQL
)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProjectDatabase</span> </span>{

    <span class="hljs-meta">@AfterDeployment</span>
    <span class="hljs-meta">@UsesRelationalDatabase</span>(dataModel = ProjectDatabase.class)
    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">migrationSchema</span><span class="hljs-params">()</span>  </span>{
        DatabaseClient databaseClient = ClientBuilder.getRelationalDatabase(ProjectDatabase.class);
        Connection connection = databaseClient.getConnection();

        <span class="hljs-keyword">try</span> {
            Database database = DatabaseFactory.getInstance().findCorrectDatabaseImplementation(<span class="hljs-keyword">new</span> JdbcConnection(connection));

            Liquibase liquibase = <span class="hljs-keyword">new</span> liquibase.Liquibase(<span class="hljs-string">"resources/changelog.xml"</span>, <span class="hljs-keyword">new</span> ClassLoaderResourceAccessor(), database);

            liquibase.update(<span class="hljs-keyword">new</span> Contexts(), <span class="hljs-keyword">new</span> LabelExpression());

        } <span class="hljs-keyword">catch</span> (LiquibaseException exception) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Liquibase failed: "</span> + exception.getLocalizedMessage();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Successfully migrated"</span>;
    }
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="annotation-specification"></a><a href="#annotation-specification" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Annotation Specification</h2>
<h3><a class="anchor" aria-hidden="true" id="relationaldatabase"></a><a href="#relationaldatabase" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>@RelationalDatabase</h3>
<h4><a class="anchor" aria-hidden="true" id="required-parameters"></a><a href="#required-parameters" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Required Parameters</h4>
<ul>
<li><code>name</code> - The name of the deployed database in the cloud provider.</li>
<li><code>username</code> - Username for the master account. Can be set using environment variables.</li>
<li><code>password</code> - Password for the master account. Can be set using environment variables.</li>
<li><code>databaseLanguage</code> - Database language.</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="optional-parameters"></a><a href="#optional-parameters" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Optional Parameters</h4>
<ul>
<li><code>databaseClass</code> - Performance configuration for the database, defaults to FREE.</li>
<li><code>awsDatabaseInstance</code> - Type of database instance in AWS, e.g. <code>db.r4.large</code>. If this is set then the <code>databaseClass</code> parameter is ignored.</li>
<li><code>allocatedSizeGB</code> - Size of space to allocate in GB, default 20.</li>
<li><code>stages</code> - A list of stages that the relational database should be deployed to.</li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/resources/KeyValueStore"><span class="arrow-prev">← </span><span>Key-Value Store</span></a><a class="docs-next button" href="/docs/resources/functions/HttpFunction"><span>HTTP Function</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#basic-usage">Basic Usage</a></li><li><a href="#database-configuration">Database Configuration</a></li><li><a href="#secure-credentials">Secure Credentials</a></li><li><a href="#migrating-schema">Migrating Schema</a></li><li><a href="#annotation-specification">Annotation Specification</a><ul class="toc-headings"><li><a href="#relationaldatabase">@RelationalDatabase</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/nimbus.svg" alt="Nimbus" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/gettingstarted.html">Getting Started</a><a href="/docs/Introduction.html">Documentation</a></div><div></div><div><h5>More</h5><a href="https://github.com/thomasjallerton/nimbus-core">GitHub</a><a class="github-button" href="https://github.com/thomasjallerton/nimbus-core" data-icon="octicon-star" data-show-count="false" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2019 Thomas Allerton</section></footer></div></body></html>